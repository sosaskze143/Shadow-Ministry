<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تعديل سجل سيادي | وزارة الظلال</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="form-layout">
    <div class="glass-card form-container">
        <div class="form-header">
            <h2 class="form-title"><i class="fas fa-user-edit"></i> تعديل بيانات المواطن</h2>
            <span class="id-badge">هوية رقم: {{ user.id_num }}</span>
        </div>
        
        <form action="/api/update_user/{{ user.id_num }}" method="POST" enctype="multipart/form-data">
            <div class="form-grid">
                <div class="form-group"><label>الاسم الأول</label><input type="text" name="fname_ar" value="{{ user.fname_ar }}" required></div>
                <div class="form-group"><label>العائلة</label><input type="text" name="lname_ar" value="{{ user.lname_ar }}" required></div>
                <div class="form-group"><label>الجوال</label><input type="text" name="phone" value="{{ user.phone }}" required></div>
                <div class="form-group"><label>البريد</label><input type="text" name="email" value="{{ user.email }}" required></div>
                
                <div class="form-group">
                    <label>حالة الحساب</label>
                    <select name="is_blocked" class="status-select">
                        <option value="0" {% if not user.is_blocked %}selected{% endif %}>نشط (مصرح له)</option>
                        <option value="1" {% if user.is_blocked %}selected{% endif %} style="color: red;">محظور (مرفوض)</option>
                    </select>
                </div>

                <div class="form-group"><label>المنطقة</label>
                    <select name="region">
                        <script>
                            const currentRegion = "{{ user.region }}";
                            for(let i=1; i<=25; i++) {
                                let r = `منطقة ${i}`;
                                document.write(`<option ${currentRegion === r ? 'selected' : ''}>${r}</option>`);
                            }
                        </script>
                    </select>
                </div>
            </div>

            <div class="upload-section edit-mode">
                <img src="/static/faces/{{ user.id_num }}.jpg" class="current-face" onerror="this.src='/static/images/user_placeholder.png'">
                <div class="upload-info">
                    <p>تحديث بصمة الوجه (اختياري)</p>
                    <input type="file" name="face_img" accept="image/*" id="fileEdit">
                </div>
            </div>

            <div class="form-buttons">
                <button type="submit" class="save-btn update">حفظ التعديلات السيادية</button>
                <a href="/admin/dashboard" class="cancel-btn">إلغاء</a>
            </div>
        </form>
    </div>
</body>
</html>